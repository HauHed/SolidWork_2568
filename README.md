# ЁЯЫ░я╕П ESP32 IoT Project (Transmitter)

## ЁЯУМ Overview

р╣Вр╕Ыр╕гр╣Ар╕Ир╕Бр╕Хр╣Мр╕Щр╕╡р╣Йр╣Ар╕Ыр╣Зр╕Щр╕гр╕░р╕Ър╕Ъ IoT р╕Эр╕▒р╣Ир╕Зр╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е (Transmitter) р╕Чр╕╡р╣Ир╣Гр╕Кр╣Й ESP32 р╕кр╕│р╕лр╕гр╕▒р╕Ър╕нр╣Ир╕▓р╕Щр╕Др╣Ир╕▓р╕Ир╕▓р╕Бр╣Ар╕Лр╣Зр╕Щр╣Ар╕Лр╕нр╕гр╣М **HTU21D** р╣Бр╕ер╕░ **DS3231** р╣Бр╕ер╣Йр╕зр╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Др╕Ыр╕вр╕▒р╕Зр╕Хр╕▒р╕зр╕гр╕▒р╕Ъ/р╣Ар╕Бр╕Хр╣Ар╕зр╕вр╣Мр╕Ьр╣Ир╕▓р╕Щ **ESP-NOW**
р╣Ар╕лр╕бр╕▓р╕░р╕кр╕│р╕лр╕гр╕▒р╕Ър╕гр╕░р╕Ър╕Ър╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕Бр╕▓р╕гр╣Ар╕Бр╣Зр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕нр╕╕р╕Ур╕лр╕ар╕╣р╕бр╕┤р╣Бр╕ер╕░р╣Ар╕зр╕ер╕▓ р╣Вр╕Фр╕вр╕Ыр╕гр╕░р╕лр╕вр╕▒р╕Фр╕Юр╕ер╕▒р╕Зр╕Зр╕▓р╕Щр╕Фр╣Йр╕зр╕в Deep Sleep

---

## ЁЯФз Hardware

* **ESP32** тАУ р╕Хр╕▒р╕зр╕лр╕ер╕▒р╕Бр╕кр╕│р╕лр╕гр╕▒р╕Ър╕нр╣Ир╕▓р╕Щ sensor р╣Бр╕ер╕░р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е
* **HTU21D** тАУ Sensor р╕зр╕▒р╕Фр╕нр╕╕р╕Ур╕лр╕ар╕╣р╕бр╕┤р╣Бр╕ер╕░р╕Др╕зр╕▓р╕бр╕Кр╕╖р╣Йр╕Щ
* **DS3231** тАУ Real-Time Clock (р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Ар╕зр╕ер╕▓)
* **р╕Ыр╕╕р╣Ир╕бр╕Бр╕Ф** тАУ р╣Гр╕Кр╣Йр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╣Вр╕лр╕бр╕Ф Config (Web Server AP Mode)

---

## ЁЯза Features

* р╕нр╣Ир╕▓р╕Щр╕Др╣Ир╕▓р╕Ир╕▓р╕Б HTU21D (р╕нр╕╕р╕Ур╕лр╕ар╕╣р╕бр╕┤ / р╕Др╕зр╕▓р╕бр╕Кр╕╖р╣Йр╕Щ)
* р╕нр╣Ир╕▓р╕Щр╣Ар╕зр╕ер╕▓р╣Бр╕Ър╕Ъ Real-Time р╕Ир╕▓р╕Б DS3231
* р╕Ир╕▒р╕Фр╕гр╕╣р╕Ыр╣Бр╕Ър╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е JSON р╕Бр╣Ир╕нр╕Щр╕кр╣Ир╕З (Timestamp + Temperature)
* р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╣Ир╕▓р╕Щ ESP-NOW р╣Др╕Ыр╕вр╕▒р╕З MAC р╕Вр╕нр╕З Receiver
* р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣И **Deep Sleep 60 р╕Щр╕▓р╕Чр╕╡** р╕лр╕ер╕▒р╕Зр╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╣Ар╕гр╣Зр╕И
* р╕гр╕нр╕Зр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Бр╕гр╕Бр╣Ар╕гр╕┤р╣Ир╕бр╕Ьр╣Ир╕▓р╕Щ **Web Server (AP Mode)**
* р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕кр╕│р╣Ар╕гр╣Зр╕Ир╕Бр╣Ир╕нр╕Щр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣И Deep Sleep

---

## ЁЯУВ Project Structure

```
ESP32_Transmitter/
тФЬтФАтФА main/
тФВ   тФЬтФАтФА main.c
тФЬтФАтФА components/
тФВ   тФЬтФАтФА htu21d/
тФВ   тФФтФАтФА ds3231/
тФЬтФАтФА docs/
тФВ   тФФтФАтФА diagram.png   # System Diagram
тФФтФАтФА README.md
```

---

## ЁЯФД System Flow

1. **р╣Ар╕Кр╣Зр╕Д NVS** р╕зр╣Ир╕▓р╕нр╕╕р╕Ыр╕Бр╕гр╕Ур╣Мр╕Цр╕╣р╕Бр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕Др╕гр╕▒р╣Йр╕Зр╣Бр╕гр╕Бр╕лр╕гр╕╖р╕нр╣Др╕бр╣И (`configured flag`)
2. **р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓** тЖТ р╣Ар╕Ыр╕┤р╕Ф AP + Web Server р╣Гр╕лр╣Йр╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ MAC р╕Вр╕нр╕З Receiver р╣Бр╕ер╕░р╣Ар╕зр╕ер╕▓
3. **р╕Цр╣Йр╕▓р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╣Бр╕ер╣Йр╕з** тЖТ р╕кр╕гр╣Йр╕▓р╕З Tasks:

   * р╕нр╣Ир╕▓р╕Щ TEMP р╕Ир╕▓р╕Б HTU21D
   * р╕нр╣Ир╕▓р╕Щ TIME р╕Ир╕▓р╕Б DS3231
   * р╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╣Ир╕▓р╕Щ ESP-NOW
   * р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ыр╕╕р╣Ир╕бр╕Бр╕Фр╣Ар╕Юр╕╖р╣Ир╕нр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╣Вр╕лр╕бр╕Ф Config
4. р╕гр╕нр╣Гр╕лр╣Й **TEMP_OK_BIT** р╣Бр╕ер╕░ **TIME_OK_BIT** р╕Др╕гр╕Ър╕Бр╣Ир╕нр╕Щр╕кр╣Ир╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕е
5. р╕Ир╕▒р╕Ф JSON р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╕кр╣Ир╕З:

```json
{
  "ts": 1696990123000,
  "values": {
    "temperature": 26.50,
    "store": true
  }
}
```

* `ts` = UTC timestamp (ms)
* `temperature` = р╕нр╕╕р╕Ур╕лр╕ар╕╣р╕бр╕┤ (┬░C)
* `store` = true тЖТ р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╕ер╕З server/DB

6. р╕кр╣Ир╕З JSON р╕Ьр╣Ир╕▓р╕Щ **ESP-NOW** р╣Др╕Ыр╕вр╕▒р╕З MAC р╕Вр╕нр╕З Receiver
7. р╕гр╕нр╕вр╕╖р╕Щр╕вр╕▒р╕Щр╕Бр╕▓р╕гр╕кр╣Ир╕Зр╕кр╕│р╣Ар╕гр╣Зр╕И (`SEND_SUCCESS_BIT`) тЖТ р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣И **Deep Sleep 60 р╕Щр╕▓р╕Чр╕╡**
8. р╕лр╕ер╕▒р╕З Deep Sleep р╕Др╕гр╕Ъ 60 р╕Щр╕▓р╕Чр╕╡ тЖТ р╕Хр╕╖р╣Ир╕Щр╕Вр╕╢р╣Йр╕Щр╕бр╕▓р╕нр╣Ир╕▓р╕Щр╕Др╣Ир╕▓р╣Гр╕лр╕бр╣Ир╣Бр╕ер╣Йр╕зр╕кр╣Ир╕Зр╕гр╕нр╕Ър╕Цр╕▒р╕Фр╣Др╕Ы

---

## ЁЯЦ╝я╕П System Diagram

![System Diagram](docs/diagram.png)

**р╕Др╕│р╕нр╕Шр╕┤р╕Ър╕▓р╕в Diagram:**

* HTU21D тЖТ р╕нр╣Ир╕▓р╕Щ Temp/Humidity
* DS3231 тЖТ р╕нр╣Ир╕▓р╕Щр╣Ар╕зр╕ер╕▓
* ESP32 тЖТ р╕Ир╕▒р╕Ф JSON тЖТ р╕кр╣Ир╕Зр╕Ьр╣Ир╕▓р╕Щ ESP-NOW тЖТ Receiver
* Deep Sleep тЖТ р╕гр╕нр╕гр╕нр╕Ър╕Хр╣Ир╕нр╣Др╕Ы

---

## тЪЩя╕П Build & Flash

1. р╣Ар╕Ыр╕┤р╕Ф ESP-IDF Terminal р╕лр╕гр╕╖р╕н VSCode + ESP-IDF Extension
2. р╕Хр╕▒р╣Йр╕З target ESP32:

```bash
idf.py set-target esp32
```

3. Build р╣Вр╕Др╣Йр╕Ф:

```bash
idf.py build
```

4. Flash р╕ер╕З ESP32:

```bash
idf.py flash
```

5. р╕Фр╕╣ Serial Monitor:

```bash
idf.py monitor
```

---

## ЁЯУЭ Configuration (р╕Др╕гр╕▒р╣Йр╕Зр╣Бр╕гр╕Б)

* р╕лр╕ер╕▒р╕З Flash ESP32 р╕Ир╕░р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣И **Web Server AP Mode**
* **SSID:** `DS3231_Setup`
* **Password:** `12345678`
* р╣Ар╕Вр╣Йр╕▓р╣Ар╕зр╣Зр╕Ъ `http://192.168.4.1`
* р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓:

  * MAC р╕Вр╕нр╕З Receiver
  * р╣Ар╕зр╕ер╕▓ (р╕зр╕▒р╕Щ/р╣Ар╕Фр╕╖р╕нр╕Щ/р╕Ыр╕╡, р╕Кр╕▒р╣Ир╕зр╣Вр╕бр╕З/р╕Щр╕▓р╕Чр╕╡)
* р╕Ър╕▒р╕Щр╕Чр╕╢р╕Б тЖТ ESP32 р╕гр╕╡р╕кр╕Хр╕▓р╕гр╣Мр╕Чр╣Бр╕ер╕░р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╕Ыр╕Бр╕Хр╕┤

**р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╣Вр╕лр╕бр╕Ф Config р╕нр╕╡р╕Бр╕Др╕гр╕▒р╣Йр╕З:**

* р╕Бр╕Фр╕Ыр╕╕р╣Ир╕бр╕Ър╕Щ ESP32 тЖТ р╣Ар╕Ыр╕┤р╕Ф AP + Web Server

---

## ЁЯУК Example JSON from ESP32

```json
{
  "ts": 1696990123000,
  "values": {
    "temperature": 26.5,
    "store": true
  }
}
```

---

## ЁЯз╛ License

MIT
